<!-- earnings.component.html -->
<div class="earnings-container">
  <!-- Header Section -->
  <div class="earnings-header">
    <div class="header-content">
      <h1 class="page-title">Driver Earnings</h1>
      <div class="header-actions">
        <button class="btn btn-primary" (click)="exportEarnings()">
          <i class="icon-download"></i> Export
        </button>
        <button class="btn btn-secondary" (click)="openGoalModal()">
          <i class="icon-target"></i> Set Goal
        </button>
      </div>
    </div>
    
    <!-- Period Selector -->
    <div class="period-selector">
      <button 
        *ngFor="let period of periodOptions" 
        class="period-btn"
        [class.active]="selectedPeriod === period.value"
        (click)="selectPeriod(period.value)">
        {{ period.label }}
      </button>
      <div class="date-range" *ngIf="selectedPeriod === 'custom'">
        <input type="date" [(ngModel)]="customDateFrom" (change)="applyFilters()">
        <span>to</span>
        <input type="date" [(ngModel)]="customDateTo" (change)="applyFilters()">
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-grid" *ngIf="earningsSummary">
    <div class="summary-card total-earnings">
      <div class="card-header">
        <h3>Total Earnings</h3>
        <i class="icon-dollar-sign"></i>
      </div>
      <div class="card-content">
        <div class="amount">{{ earningsSummary.totalEarnings | currency:'USD':'symbol':'1.2-2' }}</div>
        <div class="comparison" [ngClass]="getComparisonClass(earningsComparison.change)">
          <i [class]="getComparisonIcon(earningsComparison.changeType)"></i>
          {{ earningsComparison.change | number:'1.1-1' }}% vs last period
        </div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-header">
        <h3>Total Trips</h3>
        <i class="icon-car"></i>
      </div>
      <div class="card-content">
        <div class="amount">{{ earningsSummary.totalTrips | number }}</div>
        <div class="subtitle">{{ earningsSummary.averagePerTrip | currency:'USD':'symbol':'1.2-2' }} per trip</div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-header">
        <h3>Tips Received</h3>
        <i class="icon-heart"></i>
      </div>
      <div class="card-content">
        <div class="amount">{{ earningsSummary.totalTips | currency:'USD':'symbol':'1.2-2' }}</div>
        <div class="subtitle">{{ (earningsSummary.totalTips / earningsSummary.totalTrips) | currency:'USD':'symbol':'1.2-2' }} per trip</div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-header">
        <h3>Net Earnings</h3>
        <i class="icon-trending-up"></i>
      </div>
      <div class="card-content">
        <div class="amount">{{ earningsSummary.netEarnings | currency:'USD':'symbol':'1.2-2' }}</div>
        <div class="subtitle">After fees & deductions</div>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-toggle" (click)="showFilters = !showFilters">
      <span>Filters</span>
      <i class="icon-chevron-down" [class.rotated]="showFilters"></i>
    </div>
    
    <div class="filters-content" [class.visible]="showFilters">
      <div class="filter-row">
        <div class="filter-group">
          <label>Payout Status</label>
          <select [(ngModel)]="filters.payoutStatus" (change)="applyFilters()" multiple>
            <option value="pending">Pending</option>
            <option value="processing">Processing</option>
            <option value="completed">Completed</option>
            <option value="failed">Failed</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>Trip Type</label>
          <select [(ngModel)]="filters.tripType" (change)="applyFilters()">
            <option value="">All Types</option>
            <option value="standard">Standard</option>
            <option value="premium">Premium</option>
            <option value="shared">Shared</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>Amount Range</label>
          <div class="amount-range">
            <input type="number" placeholder="Min" [(ngModel)]="filters.minAmount" (change)="applyFilters()">
            <input type="number" placeholder="Max" [(ngModel)]="filters.maxAmount" (change)="applyFilters()">
          </div>
        </div>
        
        <div class="filter-group">
          <label>Sort By</label>
          <select [(ngModel)]="filters.sortBy" (change)="applyFilters()">
            <option value="date">Date</option>
            <option value="amount">Amount</option>
            <option value="trip_count">Trip Count</option>
            <option value="tips">Tips</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="chart-container">
      <h3>Earnings Trend</h3>
      <div class="chart-placeholder">
        <!-- Chart component would go here -->
        <canvas #earningsChart></canvas>
      </div>
    </div>
    
    <div class="insights-container">
      <h3>Insights</h3>
      <div class="insights-grid" *ngIf="earningsInsights">
        <div class="insight-item">
          <div class="insight-label">Best Earning Day</div>
          <div class="insight-value">{{ earningsInsights.bestEarningDay }}</div>
        </div>
        <div class="insight-item">
          <div class="insight-label">Peak Hours</div>
          <div class="insight-value">{{ earningsInsights.bestEarningTime }}</div>
        </div>
        <div class="insight-item">
          <div class="insight-label">Hourly Rate</div>
          <div class="insight-value">{{ earningsInsights.averageHourlyRate | currency:'USD':'symbol':'1.2-2' }}/hr</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Earnings Table -->
  <div class="table-section">
    <div class="table-header">
      <h3>Recent Earnings</h3>
      <div class="table-actions">
        <button class="btn btn-outline" (click)="refreshData()">
          <i class="icon-refresh"></i> Refresh
        </button>
      </div>
    </div>
    
    <div class="table-container">
      <table class="earnings-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Trip ID</th>
            <th>Base Fare</th>
            <th>Tips</th>
            <th>Bonuses</th>
            <th>Deductions</th>
            <th>Net Earning</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let earning of paginatedEarnings; trackBy: trackByEarningId">
            <td>{{ earning.date | date:'short' }}</td>
            <td class="trip-id">{{ earning.tripId }}</td>
            <td class="amount">{{ earning.baseFare | currency:'USD':'symbol':'1.2-2' }}</td>
            <td class="amount tips">{{ earning.tips | currency:'USD':'symbol':'1.2-2' }}</td>
            <td class="amount bonuses">
              {{ getBonusTotal(earning.bonuses) | currency:'USD':'symbol':'1.2-2' }}
            </td>
            <td class="amount deductions">
              {{ getDeductionTotal(earning.deductions) | currency:'USD':'symbol':'1.2-2' }}
            </td>
            <td class="amount net-earning">
              {{ earning.netEarning | currency:'USD':'symbol':'1.2-2' }}
            </td>
            <td>
              <span class="status-badge" [ngClass]="'status-' + earning.payoutStatus">
                {{ earning.payoutStatus | titlecase }}
              </span>
            </td>
            <td class="actions">
              <button class="btn-icon" (click)="viewEarningDetails(earning)">
                <i class="icon-eye"></i>
              </button>
              <button class="btn-icon" (click)="downloadReceipt(earning)">
                <i class="icon-download"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="pagination-btn" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
        Previous
      </button>
      <span class="pagination-info">
        Page {{ currentPage }} of {{ totalPages }}
      </span>
      <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading earnings data...</p>
  </div>
</div>

<!-- Modals -->
<div class="modal-overlay" *ngIf="showGoalModal" (click)="closeGoalModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Set Earnings Goal</h3>
      <button class="modal-close" (click)="closeGoalModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <form #goalForm="ngForm" (ngSubmit)="saveGoal()">
        <div class="form-group">
          <label>Goal Type</label>
          <select [(ngModel)]="newGoal.type" name="goalType" required>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        <div class="form-group">
          <label>Target Amount</label>
          <input type="number" [(ngModel)]="newGoal.targetAmount" name="targetAmount" required>
        </div>
        <div class="form-group">
          <label>Period</label>
          <select [(ngModel)]="newGoal.period" name="period" required>
            <option value="today">Today</option>
            <option value="this_week">This Week</option>
            <option value="this_month">This Month</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeGoalModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="!goalForm.valid">Save Goal</button>
        </div>
      </form>
    </div>
  </div>
</div>